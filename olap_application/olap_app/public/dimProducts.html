<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dim Products & OLAP Reports</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    button { padding: 10px 20px; margin: 5px; }
    h2 { margin-top: 40px; }
  </style>
</head>
<body>
  <h1>Dim Products & OLAP Reports</h1>

  <!-- Dim Products Section -->
  <h2>Dim Products</h2>
  <table id="productsTable">
    <thead>
      <tr>
        <th>Product Key</th>
        <th>Source Product ID</th>
        <th>Product Code</th>
        <th>Category</th>
        <th>Description</th>
        <th>Name</th>
        <th>Price</th>
        <th>Created At</th>
        <th>Updated At</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="loadMoreProductsBtn">Load More</button>

  <!-- Top Categories Section -->
  <h2>Top Categories</h2>
  <button id="loadTopCategoriesBtn">Load Top Categories</button>
  <table id="topCategoriesTable">
    <thead>
      <tr>
        <th>Category</th>
        <th>Total Quantity Ordered</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Top Products Section -->
  <h2>Top Products by Category</h2>
  <button id="loadTopProductsBtn">Load Top Products</button>
  <table id="topProductsTable">
    <thead>
      <tr>
        <th>Category</th>
        <th>Name</th>
        <th>Total Quantity</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="loadMoreTopProductsBtn">Load More</button>




  <!-- Slice Products by Category -->
<h2>Slice Products by Category</h2>
<select id="sliceCategorySelect">
  <option value="">--Select Category--</option>
  <!-- Categories will be loaded dynamically -->
</select>
<button id="loadSliceBtn">Load Slice</button>

<table id="sliceTable">
  <thead>
    <tr>
      <th>Category</th>
      <th>Product Name</th>
      <th>Total Quantity</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Dice Products</h2>

<!-- Dice Filters -->
<div id="diceFilters">
  <label>Category:</label>
  <select id="diceCategorySelect">
    <option value="">--All Categories--</option>
  </select>

  <label>Price Min:</label>
  <input type="number" id="dicePriceMin" placeholder="Min Price">

  <label>Price Max:</label>
  <input type="number" id="dicePriceMax" placeholder="Max Price">

  <label>Created From:</label>
  <input type="date" id="diceCreatedFrom">

  <label>Created To:</label>
  <input type="date" id="diceCreatedTo">

  <label>Search Name:</label>
  <input type="text" id="diceNameSearch" placeholder="Product Name">

  <button id="loadDiceBtn">Load Dice</button>
</div>

<!-- Dice Table -->
<table id="diceTable">
  <thead>
    <tr>
      <th>Product Key</th>
      <th>Source Product ID</th>
      <th>Product Code</th>
      <th>Category</th>
      <th>Name</th>
      <th>Price</th>
      <th>Created At</th>
      <th>Updated At</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<button id="loadMoreDiceBtn">Load More</button>

  <button onclick="history.back()">Back</button>
  <script>
    //Dim Products
    let productsOffset = 0;
    const productsLimit = 100;

    async function loadProducts() {
      const res = await fetch(`/report/dim-products?offset=${productsOffset}&limit=${productsLimit}`);
      const data = await res.json();
      const tbody = document.querySelector("#productsTable tbody");

      data.data.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${p.product_key}</td>
          <td>${p.source_product_id}</td>
          <td>${p.product_code}</td>
          <td>${p.category}</td>
          <td>${p.description}</td>
          <td>${p.name}</td>
          <td>${p.price}</td>
          <td>${p.created_at}</td>
          <td>${p.updated_at}</td>
        `;
        tbody.appendChild(row);
      });

      productsOffset += productsLimit;

      if (data.row_count < productsLimit) {
        document.getElementById("loadMoreProductsBtn").disabled = true;
        document.getElementById("loadMoreProductsBtn").innerText = "No More Rows";
      }
    }

    document.getElementById("loadMoreProductsBtn").addEventListener("click", loadProducts);
    loadProducts(); 

    //Top Categories
    async function loadTopCategories() {
      const res = await fetch("/report/top-categories");
      const data = await res.json();
      const tbody = document.querySelector("#topCategoriesTable tbody");
      tbody.innerHTML = ""; 

      data.forEach(c => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${c.product_category}</td>
          <td>${c.total_quantity_ordered}</td>
        `;
        tbody.appendChild(row);
      });
    }

    document.getElementById("loadTopCategoriesBtn").addEventListener("click", loadTopCategories);

//Top Products
let topProductsOffset = 0;       
const topProductsLimit = 50;     

async function loadTopProducts() {
  const res = await fetch(`/report/top-products?offset=${topProductsOffset}&limit=${topProductsLimit}`);
  const data = await res.json();
  const tbody = document.querySelector("#topProductsTable tbody");


  data.data.forEach(p => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${p.category}</td>
      <td>${p.name}</td>
      <td>${p.total_quantity}</td>
    `;
    tbody.appendChild(row);
  });

  topProductsOffset += topProductsLimit;

  if (data.row_count < topProductsLimit) {
    const btn = document.getElementById("loadTopProductsBtn");
    btn.disabled = true;
    btn.innerText = "No More Rows";
  }
}


document.getElementById("loadTopProductsBtn").addEventListener("click", loadTopProducts);





    //slice script

async function loadCategories() {
  const res = await fetch("/report/top-categories");
  const data = await res.json();
  const select = document.getElementById("sliceCategorySelect");
  data.forEach(c => {
    const option = document.createElement("option");
    option.value = c.product_category;
    option.innerText = c.product_category;
    select.appendChild(option);
  });
}

async function loadSlice() {
  const category = document.getElementById("sliceCategorySelect").value;
  if (!category) return alert("Please select a category");

  const res = await fetch(`/report/slice-products?category=${encodeURIComponent(category)}`);
  const data = await res.json();
  const tbody = document.querySelector("#sliceTable tbody");
  tbody.innerHTML = "";

  data.data.forEach(p => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${p.category}</td>
      <td>${p.name}</td>
      <td>${p.total_quantity}</td>
    `;
    tbody.appendChild(row);
  });
}

document.getElementById("loadSliceBtn").addEventListener("click", loadSlice);


loadCategories();

// dice script
let diceOffset = 0;
const diceLimit = 50;
let currentDiceFilters = {};


async function loadDiceCategories() {
  const res = await fetch("/report/top-categories");
  const data = await res.json();
  const select = document.getElementById("diceCategorySelect");
  data.forEach(c => {
    const option = document.createElement("option");
    option.value = c.product_category;
    option.innerText = c.product_category;
    select.appendChild(option);
  });
}

async function loadDice(reset=false) {
  if (reset) diceOffset = 0;

  const category = document.getElementById("diceCategorySelect").value;
  const priceMin = document.getElementById("dicePriceMin").value;
  const priceMax = document.getElementById("dicePriceMax").value;
  const createdFrom = document.getElementById("diceCreatedFrom").value;
  const createdTo = document.getElementById("diceCreatedTo").value;
  const nameSearch = document.getElementById("diceNameSearch").value;

  currentDiceFilters = { category, priceMin, priceMax, createdFrom, createdTo, nameSearch };


  const params = new URLSearchParams({
    ...currentDiceFilters,
    limit: diceLimit,
    offset: diceOffset
  });

  const res = await fetch(`/report/dice-products?${params.toString()}`);
  const data = await res.json();
  const tbody = document.querySelector("#diceTable tbody");

  if (reset) tbody.innerHTML = ""; 

  data.data.forEach(p => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${p.product_key}</td>
      <td>${p.source_product_id}</td>
      <td>${p.product_code}</td>
      <td>${p.category}</td>
      <td>${p.name}</td>
      <td>${p.price}</td>
      <td>${p.created_at}</td>
      <td>${p.updated_at}</td>
    `;
    tbody.appendChild(row);
  });

  diceOffset += diceLimit;


  if (data.row_count < diceLimit) {
    document.getElementById("loadMoreDiceBtn").disabled = true;
    document.getElementById("loadMoreDiceBtn").innerText = "No More Rows";
  } else {
    document.getElementById("loadMoreDiceBtn").disabled = false;
    document.getElementById("loadMoreDiceBtn").innerText = "Load More";
  }
}

document.getElementById("loadDiceBtn").addEventListener("click", () => loadDice(true));
document.getElementById("loadMoreDiceBtn").addEventListener("click", () => loadDice(false));

loadDiceCategories();
  </script>
</body>
</html>
